{"name":"quick-pomelo","tagline":"Rapid and robust game server framework based on pomelo and memdb","body":"## Why Quick?\r\n\r\n- __Performance__ : In memory data access which is extremely fast.\r\n\r\n- __Scalable__ : System is horizontally scalable, you can simply add more servers to increase system capacity.\r\n\r\n- __Transaction__ : Full transaction support like traditional database, data consistency is guaranteed.\r\n\r\n- __High Availability__ : Each server is backed by one or more replica, you will never lose any committed data.\r\n\r\n- __'MVC' Architecture__ : Define data model using 'mongoose'.\r\n\r\n## Documents\r\n\r\n* __[The Wiki](https://github.com/rain1017/quick-pomelo/wiki)__\r\n\r\n## Demos\r\n\r\n* __[Demo Game(斗地主)](https://github.com/rain1017/quick-pomelo-demo)__\r\n\r\n## Quick Start\r\n\r\n### Prerequisites\r\n\r\n#### [Pomelo](https://github.com/NetEase/pomelo)\r\n\r\nQuick-pomelo is based on pomelo, have a draft idea of pomelo framework is required.\r\n\r\n#### [MemDB](https://github.com/rain1017/memdb)\r\n\r\nQuick-pomelo use memdb for underlaying data storage, so understanding memdb is required.\r\n\r\n### Install dependencies\r\n\r\n* Install [Node.js](https://nodejs.org/download)\r\n* Install [Redis](http://redis.io/download) (required for memdb)\r\n* Install [MongoDB](https://www.mongodb.org/downloads) (required for memdb)\r\n* Install [MemDB](https://github.com/rain1017/memdb)\r\n```\r\nsudo npm install -g memdb-server\r\n```\r\n\r\n### Start with template\r\n\r\nFirst copy the template to your working directory. The template contains most common skeletons for a quick-pomelo game server.\r\n\r\n\r\n### Define models\r\n\r\nDefine data models in app/models directory\r\n\r\n```js\r\n// app/models/player.js\r\nmodule.exports = function(app){\r\n    var mdbgoose = app.memdb.goose;\r\n\r\n    var PlayerSchema = new mdbgoose.Schema({\r\n        _id : {type : String},\r\n        areaId : {type : String},\r\n        teamId : {type : String},\r\n        connectorId : {type : String},\r\n        name : {type : String},\r\n    }, {collection : 'players'});\r\n\r\n    mdbgoose.model('Player', PlayerSchema);\r\n};\r\n```\r\n\r\n### Write controllers \r\n\r\nWrite controllers in app/controllers directory\r\n\r\n```js\r\n// app/controllers/player.js\r\nvar Controller = function(app){\r\n    this.app = app;\r\n};\r\n\r\nvar proto = Controller.prototype;\r\n\r\nproto.createPlayerAsync = function(opts){\r\n    // Get model by this.app.models.[model]\r\n    var player = new this.app.models.Player(opts);\r\n    yield player.saveAsync();\r\n};\r\n\r\nproto.removePlayerAsync = function(playerId){\r\n    var player = yield this.app.models.Player.findAsync(playerId);\r\n    if(!player){\r\n        throw new Error('player not exist');\r\n    }\r\n    yield player.removeAsync();\r\n};\r\n\r\nmodule.exports = function(app){\r\n    return new Controller(app);\r\n};\r\n```\r\n\r\n### Define routes\r\n\r\nFor each type of server, write a route in app/routes directory.\r\n\r\n```js\r\n// app/routes/player.js\r\nmodule.exports = {\r\n    // Routing in handler\r\n    handler : function(session, method, msg){\r\n        // Return a string routing key\r\n        // Same routing key always route to the same backend server.\r\n        return session.uid || msg.playerId;\r\n    },\r\n    // Routing in remote\r\n    remote : function(routeParam, method, args){\r\n        return routeParam;\r\n    }\r\n};\r\n```\r\n\r\n### Write server handlers\r\n\r\nWrite server handlers in app/servers/[server]/handler\r\n\r\n```js\r\n// app/servers/player/playerHandler.js\r\nvar Handler = function(app){\r\n    this.app = app;\r\n};\r\n\r\nHandler.prototype.createPlayer = function(msg, session, next){\r\n    // Get controller by this.app.controllers.[controler]\r\n    return this.app.controllers.player.createPlayerAsync(msg.opts)\r\n    .nodeify(next); \r\n};\r\n\r\nmodule.exports = function(app){\r\n    return new Handler(app);\r\n};\r\n```\r\n\r\n### Start server\r\nStart memdb cluster\r\n```\r\nmemdbcluster start --conf=[path to .memdb.js]\r\n```\r\nStart quick pomelo server\r\n```\r\nnpm install\r\nnode app.js\r\n```\r\n\r\n### Well done! Congratulations!\r\n\r\n\r\n## Quick's Philosophy\r\n\r\nA typical realtime game server framework is stateful for the sake of performance, all states is kept in server local memory. However, this approach has significant drawbacks:\r\n\r\n- Any exceptions (may be caused by bugs or unexpected client input) may result in non-consistent state (half-modified dirty data), which is very difficult to recover\r\n- Concurrency control is very difficult to implement\r\n- We must remember which server the data is located, and use rpc to get data, which is error prone.\r\n- In memory data will be lost on server failure, it's very difficult to support HA\r\n\r\nThanks to [memdb](http://memdb.org), quick pomelo un-invent the stateful approach and use a web server like 'MVC' based architecture. All servers become stateless and all states is stored in memdb. You can now get all benefits from a typical stateless web server, without losing performance and scalability of in memory stateful server.\r\n\r\n\r\n## License\r\n\r\nQuick Pomelo - Rapid and robust game server framework based on pomelo and memdb\r\n\r\nCopyright (C) rain1017\r\n\r\nThis program is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nThis program is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\r\n","google":"UA-65398000-1","note":"Don't delete this file! It's used internally to help with page regeneration."}